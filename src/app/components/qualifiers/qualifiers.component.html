<mat-accordion>
  <!-- UEFA Section -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>UEFA Qualifying - In Progress</mat-panel-title>
    </mat-expansion-panel-header>
    <form [formGroup]="UefaQualifiersForm">
      <div class="groups-grid">
        <div *ngFor="let letter of UefaGroupLetters" class="group" [formGroupName]="'group' + letter">
          <!-- ...group fields as before... -->
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 1st place</mat-label>
            <mat-select formControlName="pos1">
              <mat-option *ngFor="let t of UefaGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(UefaGroupedTeams[letter].length) > 2 && UefaQualifiersForm.get('group' + letter + '.pos2')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="UefaQualifiersForm.get('group' + letter + '.pos1')?.hasError('required') && (UefaQualifiersForm.get('group' + letter + '.pos1')?.touched || UefaQualifiersForm.touched)">
              Select the 1st place team.
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 2nd place</mat-label>
            <mat-select formControlName="pos2">
              <mat-option *ngFor="let t of UefaGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(UefaGroupedTeams[letter].length) > 2 && UefaQualifiersForm.get('group' + letter + '.pos1')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="UefaQualifiersForm.get('group' + letter + '.pos2')?.hasError('required') && (UefaQualifiersForm.get('group' + letter + '.pos2')?.touched || UefaQualifiersForm.touched)">
              Select the 2nd place team.
            </mat-error>
            <mat-error *ngIf="UefaQualifiersForm.get('group' + letter)?.errors?.['positionsSame'] && (UefaQualifiersForm.get('group' + letter + '.pos2')?.touched || UefaQualifiersForm.touched)">
              1st and 2nd cannot be the same team.
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <!-- Playoff dropdowns always below main grid -->
      <div class="groups-grid playoff-grid">
        <!-- Add any UEFA playoff dropdowns here if needed -->
      </div>
    </form>
  </mat-expansion-panel>

  <!-- AFC Section -->
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>AFC Qualifying - In Progress</mat-panel-title>
    </mat-expansion-panel-header>
    <form [formGroup]="AfcQualifiersForm">
      <div class="groups-grid">
        <div *ngFor="let letter of AfcGroupLetters" class="group" [formGroupName]="'group' + letter">
          <!-- ...group fields as before... -->
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 1st place</mat-label>
            <mat-select formControlName="pos1">
              <mat-option *ngFor="let t of AfcGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(AfcGroupedTeams[letter].length) > 2 && AfcQualifiersForm.get('group' + letter + '.pos2')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="AfcQualifiersForm.get('group' + letter + '.pos1')?.hasError('required') && (AfcQualifiersForm.get('group' + letter + '.pos1')?.touched || AfcQualifiersForm.touched)">
              Select the 1st place team.
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 2nd place</mat-label>
            <mat-select formControlName="pos2">
              <mat-option *ngFor="let t of AfcGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(AfcGroupedTeams[letter].length) > 2 && AfcQualifiersForm.get('group' + letter + '.pos1')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="AfcQualifiersForm.get('group' + letter + '.pos2')?.hasError('required') && (AfcQualifiersForm.get('group' + letter + '.pos2')?.touched || AfcQualifiersForm.touched)">
              Select the 2nd place team.
            </mat-error>
            <mat-error *ngIf="AfcQualifiersForm.get('group' + letter)?.errors?.['positionsSame'] && (AfcQualifiersForm.get('group' + letter + '.pos2')?.touched || AfcQualifiersForm.touched)">
              1st and 2nd cannot be the same team.
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <!-- Playoff dropdowns always below main grid -->
      <div class="groups-grid playoff-grid">
        <div class="interconf-playoff-choice">
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Inter-confederation Play-off</mat-label>
            <mat-select [value]="selectedAfcRunner" [compareWith]="compareTeams" (selectionChange)="onAfcRunnerChange($event.value)">
              <mat-option *ngFor="let t of afcPos2List" [value]="t">{{ t.name }}</mat-option>
            </mat-select>
            <mat-hint>Select one of the two runners-up</mat-hint>
          </mat-form-field>
        </div>
      </div>
    </form>
  </mat-expansion-panel>

  <!-- CAF Section -->
  <mat-expansion-panel *ngIf="CafQualifiersForm">
    <mat-expansion-panel-header>
      <mat-panel-title>CAF Qualifying - In Progress</mat-panel-title>
    </mat-expansion-panel-header>
    <form [formGroup]="CafQualifiersForm">
      <div class="groups-grid">
        <div *ngFor="let letter of CafGroupLetters" class="group" [formGroupName]="'group' + letter">
          <!-- ...group fields as before... -->
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 1st place</mat-label>
            <mat-select formControlName="pos1">
              <mat-option *ngFor="let t of CafGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(CafGroupedTeams[letter].length) > 2 && CafQualifiersForm.get('group' + letter + '.pos2')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="CafQualifiersForm.get('group' + letter + '.pos1')?.hasError('required') && (CafQualifiersForm.get('group' + letter + '.pos1')?.touched || CafQualifiersForm.touched)">
              Select the 1st place team.
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 2nd place</mat-label>
            <mat-select formControlName="pos2">
              <mat-option *ngFor="let t of CafGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(CafGroupedTeams[letter].length) > 2 && CafQualifiersForm.get('group' + letter + '.pos1')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="CafQualifiersForm.get('group' + letter + '.pos2')?.hasError('required') && (CafQualifiersForm.get('group' + letter + '.pos2')?.touched || CafQualifiersForm.touched)">
              Select the 2nd place team.
            </mat-error>
            <mat-error *ngIf="CafQualifiersForm.get('group' + letter)?.errors?.['positionsSame'] && (CafQualifiersForm.get('group' + letter + '.pos2')?.touched || CafQualifiersForm.touched)">
              1st and 2nd cannot be the same team.
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <!-- Playoff dropdowns always below main grid -->
      <div class="groups-grid playoff-grid">
        <div *ngIf="cafPlayoffForm" [formGroup]="cafPlayoffForm" class="caf-playoff-choice">
          <!-- CAF Playoff Team dropdowns -->
          <mat-form-field appearance="outline" class="group-field" *ngFor="let idx of [0,1,2,3]">
            <mat-label>CAF Playoff Team {{ idx + 1 }}</mat-label>
            <mat-select [formControlName]="'runner' + idx">
              <mat-option *ngFor="let t of cafPos2List" [value]="t.name" [disabled]="isCafOptionDisabled(t.name, idx)">
                {{ t.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <!-- Inter-confederation Playoff dropdown -->
          <div class="interconf-playoff-choice">
            <mat-form-field appearance="outline" class="group-field">
              <mat-label>Inter-confederation Play-off</mat-label>
              <mat-select [(value)]="CafIcTeam" [compareWith]="compareTeams" (selectionChange)="onCafIcChange($event.value)">
                <mat-option *ngFor="let t of CafPlayoffTeamList" [value]="t">{{ t.name }}</mat-option>
              </mat-select>
              <mat-hint>Select one of the four playoff teams</mat-hint>
            </mat-form-field>
          </div>
        </div>
      </div>
    </form>
  </mat-expansion-panel>

  <!-- CONCACAF Section -->
  <mat-expansion-panel *ngIf="ConcacafQualifiersForm">
    <mat-expansion-panel-header>
      <mat-panel-title>CONCACAF Qualifying - In Progress</mat-panel-title>
    </mat-expansion-panel-header>
    <form [formGroup]="ConcacafQualifiersForm">
      <div class="groups-grid">
        <div *ngFor="let letter of ConcacafGroupLetters" class="group" [formGroupName]="'group' + letter">
          <!-- ...group fields as before... -->
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 1st place</mat-label>
            <mat-select formControlName="pos1">
              <mat-option *ngFor="let t of ConcacafGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(ConcacafGroupedTeams[letter].length) > 2 && ConcacafQualifiersForm.get('group' + letter + '.pos2')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="ConcacafQualifiersForm.get('group' + letter + '.pos1')?.hasError('required') && (ConcacafQualifiersForm.get('group' + letter + '.pos1')?.touched || ConcacafQualifiersForm.touched)">
              Select the 1st place team.
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Group {{ letter }} — 2nd place</mat-label>
            <mat-select formControlName="pos2">
              <mat-option *ngFor="let t of ConcacafGroupedTeams[letter]"
                          [value]="t.name"
                          [disabled]="(ConcacafGroupedTeams[letter].length) > 2 && ConcacafQualifiersForm.get('group' + letter + '.pos1')?.value === t.name">
                {{ t.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="ConcacafQualifiersForm.get('group' + letter + '.pos2')?.hasError('required') && (ConcacafQualifiersForm.get('group' + letter + '.pos2')?.touched || ConcacafQualifiersForm.touched)">
              Select the 2nd place team.
            </mat-error>
            <mat-error *ngIf="ConcacafQualifiersForm.get('group' + letter)?.errors?.['positionsSame'] && (ConcacafQualifiersForm.get('group' + letter + '.pos2')?.touched || ConcacafQualifiersForm.touched)">
              1st and 2nd cannot be the same team.
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <!-- Playoff dropdowns always below main grid -->
      <div class="groups-grid playoff-grid">
        <div class="interconf-playoff-choice">
          <mat-form-field appearance="outline" class="group-field">
            <mat-label>Inter-confederation Play-off </mat-label>
            <mat-select [value]="selectedConcacafRunners" multiple [compareWith]="compareTeams" (selectionChange)="onConcacafRunnersChange($event.value)">
              <mat-option *ngFor="let t of concacafPos2List" [value]="t">{{ t.name }}</mat-option>
            </mat-select>
            <mat-hint>Select up to two distinct runners-up</mat-hint>
          </mat-form-field>
        </div>
      </div>
    </form>
  </mat-expansion-panel>
</mat-accordion>


